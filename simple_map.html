<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Map with Rectangle</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map centered on New Zealand
        const map = L.map('map').setView([-41.2865, 174.7762], 6);
        
        // Add tile layer (OpenStreetMap)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Create a rectangle around Wellington
        const bounds = [
            [-41.3, 174.7], // Southwest corner
            [-41.2, 174.8]  // Northeast corner
        ];
        
        const rectangle = L.rectangle(bounds, {
            color: "#ff7800",
            weight: 2,
            fillOpacity: 0.2
        }).addTo(map);
        
        // Center the map on the rectangle
        map.fitBounds(rectangle.getBounds());

        // Variables to track dragging state
        let isDragging = false;
        let lastPos = null;

        // Make rectangle draggable
        rectangle.on('mousedown', function(e) {
            isDragging = true;
            lastPos = e.latlng;
            map.dragging.disable(); // Disable map dragging
            
            // Prevent event propagation
            L.DomEvent.stopPropagation(e);
            L.DomEvent.preventDefault(e);
            
            // Change cursor to indicate dragging
            rectangle._path.style.cursor = 'move';
        });

        // Use document events to ensure smooth dragging even if mouse moves fast
        document.addEventListener('mousemove', function(e) {
            if (!isDragging) return;
            
            // Convert screen position to map coordinates
            const containerPoint = new L.Point(e.clientX, e.clientY);
            const layerPoint = map.containerPointToLayerPoint(containerPoint);
            const latlng = map.layerPointToLatLng(layerPoint);
            
            // Calculate the movement delta
            const latDiff = latlng.lat - lastPos.lat;
            const lngDiff = latlng.lng - lastPos.lng;
            
            // Get current bounds and shift by the movement delta
            const currentBounds = rectangle.getBounds();
            const newBounds = [
                [currentBounds.getSouthWest().lat + latDiff, currentBounds.getSouthWest().lng + lngDiff],
                [currentBounds.getNorthEast().lat + latDiff, currentBounds.getNorthEast().lng + lngDiff]
            ];
            
            // Update rectangle position
            rectangle.setBounds(newBounds);
            
            // Update last position
            lastPos = latlng;
        });

        document.addEventListener('mouseup', function() {
            if (!isDragging) return;
            
            // End dragging
            isDragging = false;
            lastPos = null;
            
            // Re-enable map dragging
            map.dragging.enable();
            
            // Reset cursor
            rectangle._path.style.cursor = '';
        });
    </script>
</body>
</html>
